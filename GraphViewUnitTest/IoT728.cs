using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using GraphView;
using Microsoft.Azure.Documents.Client;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

namespace GraphViewUnitTest
{
    public partial class IoTUnitTest
    {
        [TestMethod]
        public void IoT728()
        {
            List<string> docs = new List<string>();
            docs.Add("{\"label\": \"application\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"f3d38eaf-4f31-49dc-be15-f530e0453d71\"}], \"id\": \"a0937f51-2443-4d7b-bfa6-aa13460abeb2\", \"_etag\": \"\\\"0c00e974-0000-0000-0000-59723d310000\\\"\", \"__deleted\": [{\"_value\": false, \"id\": \"f57c1854-94a6-4c73-b5ee-0b75cc6751ee\"}], \"_rid\": \"UVAOAKuz5QHEAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHEAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500658990, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"instance\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"78bac03f-839d-476c-a991-48def65de3d9\"}], \"_id\": [{\"_value\": \"product-instance-1\", \"id\": \"45153df0-1587-4409-ba87-e0430fe2e8dc\"}], \"__v0\": [{\"_value\": 1, \"id\": \"94195221-134f-4e80-bccd-0c122fad3e47\"}], \"__v1\": [{\"_value\": 0, \"id\": \"5dd964e1-8a4e-4747-99f9-a51d5cd45b09\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"4ee93d8c-d4d1-4b8e-bac0-53b6a14f7b39\"}], \"name\": [{\"_value\": \"First product instance\", \"id\": \"69a49c45-f150-4c27-9c03-a6c874e5fa14\"}], \"__prop\": [{\"_value\": \"{\\\"product-property\\\":\\\"product-property-value-1\\\",\\\"default-property\\\":\\\"default\\\"}\", \"id\": \"7a1bebb4-aaed-48f7-b406-41db7309569e\"}], \"id\": \"991fbfc0-01ac-4d5a-acfa-a8d696862abf\", \"_etag\": \"\\\"0c002375-0000-0000-0000-59723d3a0000\\\"\", \"etag\": [{\"_value\": \"0001500328810925\", \"id\": \"af52bb00-ddd7-4e20-92e1-98d71be7bd2f\"}], \"_rid\": \"UVAOAKuz5QHFAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHFAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659000, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"instance\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"2bf0ae3e-80df-48a1-a507-28fcee204be0\"}], \"_id\": [{\"_value\": \"product-instance-2\", \"id\": \"3c72e5d1-4a1b-46d7-9b93-63a6edb2242f\"}], \"__v0\": [{\"_value\": 1, \"id\": \"275c074e-536c-4a7b-b14e-a15fc0d4d397\"}], \"__v1\": [{\"_value\": 0, \"id\": \"cc370c55-6ea9-413d-923c-658becb897dc\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"6e83ee44-e6cf-492d-aa31-53cfd4ecb25e\"}], \"name\": [{\"_value\": \"Second product instance\", \"id\": \"88b4e62c-1723-4daf-afa7-018fe21bfd5d\"}], \"__prop\": [{\"_value\": \"{\\\"product-property\\\":\\\"product-property-value-2\\\",\\\"default-property\\\":\\\"default\\\",\\\"optional-default-property\\\":\\\"default\\\"}\", \"id\": \"d9602c88-4a12-4618-8d87-05a288b64ec3\"}], \"id\": \"779f5850-c284-4e81-85d6-6388449a8deb\", \"_etag\": \"\\\"0c000775-0000-0000-0000-59723d370000\\\"\", \"etag\": [{\"_value\": \"0001500328810925\", \"id\": \"9c7d612b-5cd7-48ba-a30a-2367bb52d11b\"}], \"_rid\": \"UVAOAKuz5QHGAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHGAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500658996, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"instance\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"672db242-f08c-4d52-837c-41613bf5c7ca\"}], \"_id\": [{\"_value\": \"device-instance-1\", \"id\": \"e7830971-bc07-4c67-a1cd-a74bca869d3b\"}], \"__v0\": [{\"_value\": 1, \"id\": \"7912a015-a505-4e53-96a6-1d2f15dcbae8\"}], \"__v1\": [{\"_value\": 0, \"id\": \"1b927c30-91b5-4fbc-bc05-d3a83b1d542c\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"d63b3c1e-4e2e-4095-81cf-55ba54a6960f\"}], \"name\": [{\"_value\": \"First device instance\", \"id\": \"7fc8aa4b-9ad9-4875-bac9-3ab0108b4fd0\"}], \"__prop\": [{\"_value\": \"{\\\"device-property\\\":\\\"device-property-value-1\\\"}\", \"id\": \"369ea418-f44f-421a-9a82-c89300ccffc5\"}], \"__twin\": [{\"_value\": \"{\\\"deviceId\\\":\\\"device-instance-1\\\",\\\"etag\\\":\\\"AAAAAAAAAAE=\\\",\\\"properties\\\":{\\\"desired\\\":{},\\\"reported\\\":{}},\\\"tags\\\":{}}\", \"id\": \"b595927d-5f74-4fe0-96f0-f9f2e14ead99\"}], \"id\": \"9981a652-afb0-4bed-b84b-97c5c1390fc3\", \"_etag\": \"\\\"0c002175-0000-0000-0000-59723d3a0000\\\"\", \"etag\": [{\"_value\": \"0001500328810925\", \"id\": \"d50bf395-5e7c-4eee-80ad-ef3a1ec68c8c\"}], \"_rid\": \"UVAOAKuz5QHHAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHHAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500658999, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"instance\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"c813f455-b112-4fe1-9282-23d5ef533d03\"}], \"_id\": [{\"_value\": \"device-instance-2\", \"id\": \"afa6f2f2-8419-490f-8b18-490ad3e49a79\"}], \"__v0\": [{\"_value\": 1, \"id\": \"55532ccc-25d9-431a-b145-fd6b476fbe63\"}], \"__v1\": [{\"_value\": 0, \"id\": \"20431723-8ca7-43cd-98d0-530f76fef6c3\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"bbfbf49a-1b11-4d24-8be9-f0bf40e980e9\"}], \"name\": [{\"_value\": \"Second device instance\", \"id\": \"61a5741c-1377-44da-8955-be85ac10911f\"}], \"__prop\": [{\"_value\": \"{\\\"device-property\\\":\\\"device-property-value-2\\\"}\", \"id\": \"3710a86a-077d-4da6-aabd-f99167d0d7c0\"}], \"__twin\": [{\"_value\": \"{\\\"deviceId\\\":\\\"device-instance-2\\\",\\\"etag\\\":\\\"AAAAAAAAAAE=\\\",\\\"properties\\\":{\\\"desired\\\":{},\\\"reported\\\":{}},\\\"tags\\\":{}}\", \"id\": \"f9dcd071-09fd-4bd1-9866-d559c2f67307\"}], \"id\": \"9945bd9b-a8b3-48a4-8029-7f95923c80a0\", \"_etag\": \"\\\"0c000975-0000-0000-0000-59723d370000\\\"\", \"etag\": [{\"_value\": \"0001500328810925\", \"id\": \"49d037f4-d7e6-4fcc-84c8-855b944c1ddf\"}], \"_rid\": \"UVAOAKuz5QHIAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHIAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500658996, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"model\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"651dd5bc-8bfc-44d9-bd51-acc6573d04c0\"}], \"_id\": [{\"_value\": \"product-model\", \"id\": \"bdaa8c2b-d717-494a-840c-0e78b91dc265\"}], \"__v0\": [{\"_value\": 1, \"id\": \"bcd84dfa-bfa2-417a-a05b-4916efdc405f\"}], \"__v1\": [{\"_value\": 0, \"id\": \"3728316d-5eb1-4dcf-ab52-037ac9417346\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"9eef25df-b444-4e1d-8037-0a10a50e62d8\"}], \"name\": [{\"_value\": \"Product Model\", \"id\": \"c7c49982-6c3a-4ebf-8372-052ce99d06fe\"}], \"category\": [{\"_value\": \"product\", \"id\": \"a09fa3bc-96c4-438f-ac9e-4d83e3b0dc6c\"}], \"?properties\": [{\"_value\": \"{\\\"product-property\\\":{\\\"name\\\":\\\"Product Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"attributes\\\":[\\\"tag\\\"]},\\\"optional-property\\\":{\\\"name\\\":\\\"Optional Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"optional\\\":true},\\\"default-property\\\":{\\\"name\\\":\\\"Default Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"initialValue\\\":\\\"default\\\"},\\\"optional-default-property\\\":{\\\"name\\\":\\\"Optional Default Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"initialValue\\\":\\\"default\\\",\\\"optional\\\":true}}\", \"id\": \"0ec8b839-089d-4397-8210-e8ad8a853f4d\"}], \"id\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_etag\": \"\\\"0c007275-0000-0000-0000-59723d4c0000\\\"\", \"etag\": [{\"_value\": \"0001500328820034\", \"id\": \"5aefdcd1-3ef9-43ee-9c5f-054c1b7075ce\"}], \"_rid\": \"UVAOAKuz5QHJAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHJAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659017, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"model\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"19fda7e6-b287-402d-8dbd-0eaf1a1dc0f6\"}], \"_id\": [{\"_value\": \"device-model\", \"id\": \"cfa3855a-0a90-4273-a014-52eb8889268e\"}], \"__v0\": [{\"_value\": 1, \"id\": \"32dfda73-cc5f-4efb-b133-4b3b77e49998\"}], \"__v1\": [{\"_value\": 0, \"id\": \"c3bc98b7-eb99-422c-b911-54ac86c30983\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"c1719812-6392-45cd-a8a3-7ef5aa6601ac\"}], \"name\": [{\"_value\": \"Device Model\", \"id\": \"1bc6dd49-90da-43e1-a3c3-908d8e94f379\"}], \"category\": [{\"_value\": \"device\", \"id\": \"2687b8ea-44af-42ce-9a8f-91d6f738aac2\"}], \"?properties\": [{\"_value\": \"{\\\"device-property\\\":{\\\"name\\\":\\\"Device Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"attributes\\\":[\\\"tag\\\"]}}\", \"id\": \"21ce6c5e-0a91-40b4-9cd7-e4bc4b7f0a63\"}], \"?deviceProperties\": [{\"_value\": \"{\\\"desired-property\\\":{\\\"name\\\":\\\"Desired Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"kind\\\":\\\"desired\\\",\\\"path\\\":\\\"/desiredProperty\\\"},\\\"reported-property\\\":{\\\"name\\\":\\\"Reported Property\\\",\\\"dataType\\\":\\\"string\\\",\\\"kind\\\":\\\"reported\\\",\\\"path\\\":\\\"reported/property\\\"}}\", \"id\": \"b320ea88-4875-43a6-86fb-752ea9bd480d\"}], \"?deviceTelemetry\": [{\"_value\": \"{\\\"waterUsed\\\":{\\\"properties\\\":{\\\"volume\\\":{\\\"dataType\\\":\\\"int64\\\",\\\"minValue\\\":0,\\\"maxValue\\\":1000000000000,\\\"units\\\":\\\"milliliter\\\"}}}}\", \"id\": \"b90f673f-d03c-4f80-b22f-c80162eb3f48\"}], \"id\": \"95bb9608-d181-451a-8ddd-5bfe7ca411ff\", \"_etag\": \"\\\"0c002475-0000-0000-0000-59723d3a0000\\\"\", \"etag\": [{\"_value\": \"0001500328810925\", \"id\": \"9a3f2339-295d-4ad2-9752-71d0983fc0ec\"}], \"_rid\": \"UVAOAKuz5QHKAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHKAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659000, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"model\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"cb7bd4fd-1b6e-474f-8702-36ebcbb951e4\"}], \"_id\": [{\"_value\": \"parent-model\", \"id\": \"e858aa39-1d63-4034-bf66-1d2253ac073c\"}], \"__v0\": [{\"_value\": 1, \"id\": \"e158b207-f39b-4bd8-9bc8-2fd8fa6a8e24\"}], \"__v1\": [{\"_value\": 0, \"id\": \"80d653a7-dfd3-4aef-a85b-119d45b5d1f6\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"ff0a8f63-eca7-4ad7-a698-4f9fe6bd1f9a\"}], \"name\": [{\"_value\": \"Parent Product Model\", \"id\": \"7dda4383-b803-4df8-a749-189ab49d1e0d\"}], \"category\": [{\"_value\": \"product\", \"id\": \"01b2a2b0-d411-4e6a-b9c9-be8527144e01\"}], \"description\": [{\"_value\": \"This is a parent product model.\", \"id\": \"17a1ebfc-5849-463f-a6a9-6a3c4c5cb308\"}], \"?properties\": [{\"_value\": \"{\\\"parent-property\\\":{\\\"name\\\":\\\"Parent Property\\\",\\\"dataType\\\":\\\"string\\\"}}\", \"id\": \"94f232ec-1eda-4c63-a029-754306d2a52c\"}], \"id\": \"fd1bc7ac-0c90-46e3-8bad-141fc3ef1564\", \"_etag\": \"\\\"0c009f75-0000-0000-0000-59723d580000\\\"\", \"etag\": [{\"_value\": \"0001500328821055\", \"id\": \"789f601a-561a-4552-8ecb-f299852deade\"}], \"_rid\": \"UVAOAKuz5QHSAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHSAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659030, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"model\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"e5ad7580-86b9-4428-a1bc-30fae2a11abc\"}], \"_id\": [{\"_value\": \"product-model\", \"id\": \"4e158c5d-86a2-4e26-b92c-1980219fad5f\"}], \"__v0\": [{\"_value\": 1, \"id\": \"5aaedd99-1bab-4268-b858-c285268534fc\"}], \"__v1\": [{\"_value\": 1, \"id\": \"be2eda0c-402e-45e5-bf4b-085d83cc873c\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"ef7087b1-7e0f-44b5-89df-fcb65c1c3217\"}], \"name\": [{\"_value\": \"Product Model vLatest\", \"id\": \"494a533a-ae59-474f-862b-2c6fb8bdf2c6\"}], \"category\": [{\"_value\": \"product\", \"id\": \"b4a70270-3856-440a-8f90-02acdeca780f\"}], \"?properties\": [{\"_value\": \"{}\", \"id\": \"212c5a58-d4fe-4c9e-bad2-1bd87981a202\"}], \"id\": \"a05be8e2-e34a-4b3d-9cce-f1b07e820030\", \"_etag\": \"\\\"0c00b475-0000-0000-0000-59723d5e0000\\\"\", \"etag\": [{\"_value\": \"0001500328821601\", \"id\": \"034ef632-420e-4aac-98ab-de68b5032f38\"}], \"_rid\": \"UVAOAKuz5QHVAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHVAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659035, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"model\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"38748f83-b22c-4535-98dd-ebc59b66c05b\"}], \"_id\": [{\"_value\": \"product-model\", \"id\": \"d3d3b65a-cf71-4b29-8576-7347f58ed887\"}], \"__v0\": [{\"_value\": 2, \"id\": \"74417500-fc36-4047-b336-ed31c6ec934a\"}], \"__v1\": [{\"_value\": 0, \"id\": \"2d231564-ced0-4b46-989f-d0b0a7602f87\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"fd2866c9-c2a0-4f2a-bcf6-144623df74e4\"}], \"name\": [{\"_value\": \"Product Model v2\", \"id\": \"30638565-1b29-44ba-b446-f46090955960\"}], \"category\": [{\"_value\": \"product\", \"id\": \"6ad3f9be-b780-4f75-a8df-6870f6ecf698\"}], \"?properties\": [{\"_value\": \"{}\", \"id\": \"0f8af28c-caf5-4f79-9f1b-873e81925e44\"}], \"id\": \"33f291c7-46b2-4cf8-a009-bc905022fdd8\", \"_etag\": \"\\\"0c00b975-0000-0000-0000-59723d5f0000\\\"\", \"etag\": [{\"_value\": \"0001500328822259\", \"id\": \"45550609-9a10-4b1d-bd60-36318069296f\"}], \"_rid\": \"UVAOAKuz5QHWAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHWAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659036, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"label\": \"instance\", \"__app\": [{\"_value\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"id\": \"2a7cd914-6761-40a1-945e-edbb05e6290e\"}], \"_id\": [{\"_value\": \"parent-instance\", \"id\": \"a216276f-a5ad-4268-b8f0-0c7b63712535\"}], \"__v0\": [{\"_value\": 1, \"id\": \"4697abfb-25ca-449b-a49c-f436fe67748c\"}], \"__v1\": [{\"_value\": 0, \"id\": \"1b9e6983-d167-4be0-b429-428d6930eb0b\"}], \"_schemaVersion\": [{\"_value\": \"1.0.0\", \"id\": \"8c219dc4-f03b-4ff7-a5ee-e5514c710952\"}], \"name\": [{\"_value\": \"Parent instance\", \"id\": \"fd86a13a-bab9-4215-8b5d-86597eb1454d\"}], \"__prop\": [{\"_value\": \"{\\\"parent-property\\\":\\\"parent-property-value\\\"}\", \"id\": \"01bf52ac-d4b5-4433-8171-d22ba797fb46\"}], \"id\": \"a5e0a9c4-ea51-405b-bf70-668941480953\", \"_etag\": \"\\\"0c00da75-0000-0000-0000-59723d670000\\\"\", \"etag\": [{\"_value\": \"0001500328823039\", \"id\": \"06a02652-f2c6-4a4d-bb6e-d1dac362752e\"}], \"_rid\": \"UVAOAKuz5QHXAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHXAAAAAAAAAA==/\", \"_attachments\": \"attachments/\", \"_ts\": 1500659044, \"_edge\": [\"dummy\"], \"_reverse_edge\": [\"dummy\"], \"_edgeSpilled\": true, \"_revEdgeSpilled\": true}");
            docs.Add("{\"id\": \"534b2353-f8d7-4d26-89f3-276ca6977751\", \"_is_reverse\": false, \"_vertex_id\": \"991fbfc0-01ac-4d5a-acfa-a8d696862abf\", \"_vertex_label\": \"instance\", \"_edge\": [{\"label\": \"mdl\", \"id\": \"534b2353-f8d7-4d26-89f3-276ca6977751\", \"_sinkV\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHLAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHLAAAAAAAAAA==/\", \"_etag\": \"\\\"0c000c75-0000-0000-0000-59723d380000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658997}");
            docs.Add("{\"id\": \"27b9bbda-1ece-4a74-9540-d1da9eecd752\", \"_is_reverse\": false, \"_vertex_id\": \"779f5850-c284-4e81-85d6-6388449a8deb\", \"_vertex_label\": \"instance\", \"_edge\": [{\"label\": \"mdl\", \"id\": \"27b9bbda-1ece-4a74-9540-d1da9eecd752\", \"_sinkV\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHMAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHMAAAAAAAAAA==/\", \"_etag\": \"\\\"0c000d75-0000-0000-0000-59723d380000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658997}");
            docs.Add("{\"id\": \"a27b8528-c245-4bc3-ad68-0ae2b8c2e1b0\", \"_is_reverse\": false, \"_vertex_id\": \"9981a652-afb0-4bed-b84b-97c5c1390fc3\", \"_vertex_label\": \"instance\", \"_edge\": [{\"label\": \"mdl\", \"id\": \"a27b8528-c245-4bc3-ad68-0ae2b8c2e1b0\", \"_sinkV\": \"95bb9608-d181-451a-8ddd-5bfe7ca411ff\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHNAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHNAAAAAAAAAA==/\", \"_etag\": \"\\\"0c001275-0000-0000-0000-59723d380000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658997}");
            docs.Add("{\"id\": \"a2081ddd-d8c5-49c9-b274-b67027540df4\", \"_is_reverse\": false, \"_vertex_id\": \"9945bd9b-a8b3-48a4-8029-7f95923c80a0\", \"_vertex_label\": \"instance\", \"_edge\": [{\"label\": \"mdl\", \"id\": \"a2081ddd-d8c5-49c9-b274-b67027540df4\", \"_sinkV\": \"95bb9608-d181-451a-8ddd-5bfe7ca411ff\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHOAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHOAAAAAAAAAA==/\", \"_etag\": \"\\\"0c001375-0000-0000-0000-59723d380000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658997}");
            docs.Add("{\"id\": \"e4bde0a3-0307-4c0a-9732-4b19d09409ba\", \"_is_reverse\": false, \"_vertex_id\": \"991fbfc0-01ac-4d5a-acfa-a8d696862abf\", \"_vertex_label\": \"instance\", \"_edge\": [{\"label\": \"instance\", \"id\": \"e4bde0a3-0307-4c0a-9732-4b19d09409ba\", \"_sinkV\": \"9981a652-afb0-4bed-b84b-97c5c1390fc3\", \"_sinkVLabel\": \"instance\", \"_sinkVPartition\": null, \"__app\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"_id\": \"product-to-device-1\", \"__v0\": 1, \"__v1\": 0, \"_schemaVersion\": \"1.0.0\", \"?modelRelationshipId\": \"{\\\"id\\\":\\\"product-to-device-model\\\",\\\"versionRange\\\":\\\"1.0.0\\\"}\", \"__mdl\": \"1/0/product-to-device-model\", \"etag\": \"0001500328810925\"}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHPAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHPAAAAAAAAAA==/\", \"_etag\": \"\\\"0c001675-0000-0000-0000-59723d380000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658998}");
            docs.Add("{\"id\": \"6ab3ee2f-f5c1-4c18-b1f8-38108b42340b\", \"_is_reverse\": false, \"_vertex_id\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_vertex_label\": \"model\", \"_edge\": [{\"label\": \"model\", \"id\": \"6ab3ee2f-f5c1-4c18-b1f8-38108b42340b\", \"_sinkV\": \"95bb9608-d181-451a-8ddd-5bfe7ca411ff\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null, \"__app\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"_id\": \"product-to-device-model\", \"__v0\": 1, \"__v1\": 0, \"__mdl\": \"1/0/product-to-device-model\", \"_schemaVersion\": \"1.0.0\", \"src~cardinality\": 1, \"?tgt~referenceProperties\": \"{\\\"reference-property\\\":{\\\"name\\\":\\\"Reference Property\\\",\\\"propertyId\\\":\\\"device-property\\\"}}\", \"etag\": \"0001500328810925\"}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHQAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHQAAAAAAAAAA==/\", \"_etag\": \"\\\"0c001975-0000-0000-0000-59723d390000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658998}");
            docs.Add("{\"id\": \"dcc4efe9-e5d1-4d04-b02d-e7552e27a27f\", \"_is_reverse\": false, \"_vertex_id\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_vertex_label\": \"model\", \"_edge\": [{\"label\": \"ref\", \"id\": \"dcc4efe9-e5d1-4d04-b02d-e7552e27a27f\", \"_sinkV\": \"95bb9608-d181-451a-8ddd-5bfe7ca411ff\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null, \"__app\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"_id\": \"reference-property\", \"__ref\": \"{\\\"name\\\":\\\"Reference Property\\\",\\\"propertyId\\\":\\\"device-property\\\",\\\"__key\\\":\\\"reference-property\\\"}\", \"__key\": \"device-property\", \"__mdl\": \"1/0/product-to-device-model\", \"etag\": \"0001500328810925\"}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHRAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHRAAAAAAAAAA==/\", \"_etag\": \"\\\"0c001d75-0000-0000-0000-59723d390000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500658998}");
            docs.Add("{\"id\": \"af518b69-ca82-4bdc-8809-4b7cf6a67ec3\", \"_is_reverse\": false, \"_vertex_id\": \"fd1bc7ac-0c90-46e3-8bad-141fc3ef1564\", \"_vertex_label\": \"model\", \"_edge\": [{\"label\": \"model\", \"id\": \"af518b69-ca82-4bdc-8809-4b7cf6a67ec3\", \"_sinkV\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null, \"__app\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"_id\": \"parent-to-product-model\", \"__v0\": 1, \"__v1\": 0, \"__mdl\": \"1/0/parent-to-product-model\", \"_schemaVersion\": \"1.0.0\", \"name\": \"Updated parent to product model relationship\", \"src~cardinality\": 1, \"?tgt~referenceProperties\": \"{\\\"recursive-reference-property\\\":{\\\"name\\\":\\\"Recursive Reference Property\\\",\\\"propertyId\\\":\\\"reference-property\\\"}}\", \"?tgt~referenceMethods\": \"{\\\"recursive-reference-method\\\":{\\\"name\\\":\\\"Recursive Reference Method\\\",\\\"methodId\\\":\\\"reference-method\\\"}}\", \"etag\": \"0001500328820034\"}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHTAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHTAAAAAAAAAA==/\", \"_etag\": \"\\\"0c006c75-0000-0000-0000-59723d4b0000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500659016}");
            docs.Add("{\"id\": \"ccd48d8f-3c42-47f6-a7e6-636037f7f105\", \"_is_reverse\": false, \"_vertex_id\": \"fd1bc7ac-0c90-46e3-8bad-141fc3ef1564\", \"_vertex_label\": \"model\", \"_edge\": [{\"label\": \"ref\", \"id\": \"ccd48d8f-3c42-47f6-a7e6-636037f7f105\", \"_sinkV\": \"fd6e0afd-b45c-4ea1-a832-f2234184131b\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null, \"__app\": \"b9c64a74-6aa4-44fc-94db-4306149fd5f4\", \"_id\": \"recursive-reference-property\", \"__ref\": \"{\\\"name\\\":\\\"Recursive Reference Property\\\",\\\"propertyId\\\":\\\"reference-property\\\",\\\"__key\\\":\\\"recursive-reference-property\\\"}\", \"__key\": \"reference-property\", \"__mdl\": \"1/0/parent-to-product-model\", \"etag\": \"0001500328820034\"}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHUAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHUAAAAAAAAAA==/\", \"_etag\": \"\\\"0c006f75-0000-0000-0000-59723d4c0000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500659017}");
            docs.Add("{\"id\": \"1406b65d-e588-49a2-878d-b3b0ab0cf3f9\", \"_is_reverse\": false, \"_vertex_id\": \"a5e0a9c4-ea51-405b-bf70-668941480953\", \"_vertex_label\": \"instance\", \"_edge\": [{\"label\": \"mdl\", \"id\": \"1406b65d-e588-49a2-878d-b3b0ab0cf3f9\", \"_sinkV\": \"fd1bc7ac-0c90-46e3-8bad-141fc3ef1564\", \"_sinkVLabel\": \"model\", \"_sinkVPartition\": null}], \"_isEdgeDoc\": true, \"_rid\": \"UVAOAKuz5QHYAAAAAAAAAA==\", \"_self\": \"dbs/UVAOAA==/colls/UVAOAKuz5QE=/docs/UVAOAKuz5QHYAAAAAAAAAA==/\", \"_etag\": \"\\\"0c00dd75-0000-0000-0000-59723d680000\\\"\", \"_attachments\": \"attachments/\", \"_ts\": 1500659045}");
            CreateDocs(docs);

            //// ============== 39 ==============
            
            graph.CommandText =
                "g.inject(0).coalesce(__.not(__.V().has('__app','b9c64a74-6aa4-44fc-94db-4306149fd5f4').hasLabel('application').has('__deleted',false)).constant('~0'),__.V('a5e0a9c4-ea51-405b-bf70-668941480953').outE().has('__app','b9c64a74-6aa4-44fc-94db-4306149fd5f4').has('_id','parent-to-product').has('__v0',1).has('__v1',0).hasLabel('instance').constant('~1'),__.not(__.V('a5e0a9c4-ea51-405b-bf70-668941480953').has('etag','0001500328823039')).constant('~2'),__.not(__.V('991fbfc0-01ac-4d5a-acfa-a8d696862abf').has('etag','0001500328810925')).constant('~3'),__.V('991fbfc0-01ac-4d5a-acfa-a8d696862abf').inE('instance').has('__mdl','1/0/parent-to-product-model').count().is(gt(0)).constant('~4'),__.map(__.V('a5e0a9c4-ea51-405b-bf70-668941480953').addE('instance').to(__.V('991fbfc0-01ac-4d5a-acfa-a8d696862abf')).property('__app','b9c64a74-6aa4-44fc-94db-4306149fd5f4').property('_id','parent-to-product').property('__v0',1).property('__v1',0).property('_schemaVersion','1.0.0').property('?modelRelationshipId','{\\\"id\\\":\\\"parent-to-product-model\\\",\\\"versionRange\\\":\\\"1.0.0\\\"}').property('__mdl','1/0/parent-to-product-model').property('etag','0001500328825016').fold()).as('#+e').union(__.flatMap(__.select('#+e').unfold()).as('@r').bothV().as('@v').flatMap(__.optional(__.out('mdl')).inE('ref').and(__.as('r').select('@r','r').by('__mdl').where('r',eq('@r')))).repeat(__.as('@e').flatMap(__.select(last,'@v').bothE('instance','model').and(__.as('r').select(last,'@e','r').by('__mdl').where('r',eq('@e'))).otherV()).as('@v').simplePath().optional(__.optional(__.out('mdl')).inE('ref').and(__.as('r').select(last,'@e','r').by('_id').by('__key').where('r',eq('@e'))))).until(__.not(__.hasLabel('ref'))).select('@v').unfold().property('etag','0001500328825016')).dedup().valueMap(true, '_id', '__v0','__v1'))";
            var result = graph.ExecuteAndGetResults();
            
            foreach (var r in result)
            {
                Console.WriteLine(r);
            }
        }
    }
}
